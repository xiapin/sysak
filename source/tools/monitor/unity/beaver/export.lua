---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by liaozhaoyan.
--- DateTime: 2022/12/25 11:20 AM
---

local system = require("common.system")
local pystring = require("common.pystring")
local CfoxTSDB = require("tsdb.foxTSDB")
local CtransPro = require("common.transPro")

require("common.class")

local Cexport = class("Cexport")


function Cexport:_init_(instance, fYaml)
    self._instance = instance
    local ms = system:parseYaml(fYaml)
    self._freq = ms.config.freq
    self._timestamps = ms.config.real_timestamps

    self._tDescr = ms.metrics
    self._transPro = CtransPro.new(instance, fYaml, true, self._timestamps)
    self._fox = CfoxTSDB.new(fYaml)
end

function Cexport:export()
    local qs = {}
    self._fox:qLastMetric(self._freq + 1, qs)

    local lines = self._transPro:export(qs)
    return lines
end

return Cexport
